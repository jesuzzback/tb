<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRUMPBOB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        heading: ['Chewy', 'cursive'],
                        body: ['Fredoka', 'sans-serif'],
                    },
                    colors: {
                        'ocean-light': '#4FC3F7',
                        'ocean-dark': '#0288D1',
                        'sand': '#FFE082',
                        'sand-dark': '#FFCA28',
                        'wood': '#8D6E63',
                        'wood-dark': '#6D4C41',
                        'bubble': '#FFFFFF',
                    },
                    boxShadow: {
                        'toon': '4px 4px 0px 0px rgba(0,0,0,1)',
                        'toon-hover': '2px 2px 0px 0px rgba(0,0,0,1)',
                        'toon-wood': '4px 4px 0px 0px #3E2723',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 3s infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'breathe': 'breathe 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        glow: {
                            '0%': { filter: 'drop-shadow(0 0 2px rgba(255, 215, 0, 0.4)) brightness(1)' },
                            '100%': { filter: 'drop-shadow(0 0 15px rgba(255, 215, 0, 0.9)) brightness(1.1)' }
                        },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', filter: 'brightness(1)' },
                            '50%': { transform: 'scale(1.05)', filter: 'brightness(1.1) drop-shadow(0 0 8px rgba(255, 215, 0, 0.5))' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .text-stroke {
            -webkit-text-stroke: 2px black;
            text-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }
        .text-stroke-sm {
            -webkit-text-stroke: 1px black;
        }
        
        .wood-pattern {
            background-color: #8D6E63;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, #6D4C41 10px, #6D4C41 20px);
        }

        .responsive-bg {
            background-size: cover; 
            background-position: center bottom;
            background-repeat: no-repeat;
        }

        .hero-bg {
            background-image: url('images/background1.jpg');
            background-color: #4FC3F7;
        }
        
        .about-bg {
            background-image: url('images/background2.jpg');
            background-color: #FFE082;
        }

        .shared-bg {
            background-image: url('images/background3.jpg');
            background-color: #FFCA28;
        }

        .buy-bg {
            background-color: #FFF8E1;
        }

        .cta-bg {
            background-image: url('images/background4.jpg');
            background-color: #FFCA28;
        }

        @media (max-width: 768px) {
            .hero-bg {
                background-position: center top; 
            }
        }

        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #FFE082;
        }
        ::-webkit-scrollbar-thumb {
            background: #0288D1;
            border-radius: 6px;
            border: 3px solid #FFE082;
        }
    </style>
</head>
<body class="font-body text-gray-900 overflow-x-hidden bg-[#FFE082]">

    <div id="toast" class="fixed top-24 right-4 z-50 transform transition-all duration-300 translate-x-64 opacity-0 pointer-events-none">
        <div class="bg-green-400 border-4 border-black text-black px-6 py-3 rounded-xl shadow-toon font-heading text-xl">
            Contract Copied! ðŸ¦€
        </div>
    </div>

    <header class="fixed w-full top-0 z-40 px-4 py-3">
        <div class="max-w-7xl mx-auto bg-[#FFFDD0] border-4 border-black rounded-full shadow-toon px-4 sm:px-6 py-3 flex justify-between items-center relative z-50">
            
            <div class="flex items-center gap-2 cursor-pointer hover:scale-105 transition-transform">
                <div class="w-12 h-12 rounded-full border-2 border-black overflow-hidden bg-white shrink-0">
                    <img src="images/logo.png" alt="Logo" class="w-full h-full object-cover">
                </div>
                <span class="font-heading text-xl sm:text-2xl hidden min-[350px]:block tracking-wide">$TRUMPBOB</span>
            </div>

            <nav class="hidden md:flex gap-6 font-bold text-lg text-gray-700">
                <a href="#memegenerator" class="hover:text-ocean-dark hover:-translate-y-1 transition-transform">Meme Generator</a>
                <a href="#about" class="hover:text-ocean-dark hover:-translate-y-1 transition-transform">About</a>
            </nav>

            <div class="flex items-center gap-2 sm:gap-3">
                
                <a href="https://x.com/i/communities/2008879204515860503" target="_blank" class="bg-black hover:bg-gray-800 text-white font-heading text-lg sm:text-xl px-4 py-1 rounded-full border-4 border-white shadow-toon hover:shadow-toon-hover hover:translate-y-[2px] transition-all block">
                    X
                </a>

                <a href="https://pump.fun/coin/HEaHbZRnTX74EY6jGwYgJbfaqzs3oufQL2oPve4Dpump" target="_blank" class="bg-[#FFD700] hover:bg-[#FFC107] text-black font-heading text-lg sm:text-xl px-4 sm:px-6 py-1 rounded-full border-4 border-black shadow-toon hover:shadow-toon-hover hover:translate-y-[2px] transition-all block">
                    BUY NOW
                </a>

                <button onclick="toggleMenu()" class="md:hidden p-1 text-black hover:text-ocean-dark transition-colors focus:outline-none">
                    <i data-lucide="menu" class="w-8 h-8"></i>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="absolute top-[calc(100%+10px)] left-4 right-4 bg-[#FFFDD0] border-4 border-black rounded-2xl shadow-toon p-4 flex flex-col gap-4 text-center font-bold text-xl hidden md:hidden z-40">
            <a href="#memegenerator" class="hover:text-ocean-dark py-2 border-b-2 border-black/10" onclick="toggleMenu()">Meme Generator</a>
            <a href="#about" class="hover:text-ocean-dark py-2" onclick="toggleMenu()">About</a>
        </div>
    </header>

    <section class="relative min-h-screen pt-32 overflow-hidden flex flex-col justify-between responsive-bg hero-bg">
        
        <div class="absolute inset-0 bg-black/10 z-0"></div>

        <div class="container mx-auto px-4 z-10 flex-grow flex flex-col items-center justify-center text-center">
            
            <div class="mb-8 transform -rotate-2 hover:scale-105 transition-transform duration-300">
                <img src="images/ticker.png" alt="$TRUMPBOB Ticker" class="max-w-full h-auto md:h-32 object-contain drop-shadow-2xl animate-breathe">
            </div>

            <div class="relative w-full max-w-lg flex justify-center items-end mb-8 z-20 animate-float">
                
                <div id="speech-bubble" class="absolute -top-16 right-0 md:-right-10 bg-white border-4 border-black px-8 py-4 rounded-[40px] rounded-bl-none shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hidden transition-all duration-300 transform origin-bottom-left z-50">
                    <p class="font-heading text-4xl text-black">Don't Touch Me Nigga</p>
                </div>

                <img src="images/character.png" alt="Mascot" onclick="sayHey()" class="w-full h-auto md:w-[500px] object-contain drop-shadow-2xl hover:scale-105 transition-transform cursor-pointer relative z-10">
            </div>

            <div class="w-full max-w-xl mx-auto mb-12 relative z-30 group">
                <div class="bg-white rounded-2xl border-4 border-black shadow-toon flex items-center p-2 transform group-hover:-translate-y-1 transition-transform">
                    <div class="bg-gray-100 rounded-xl px-4 py-2 font-mono text-gray-500 text-sm md:text-base truncate flex-grow text-left">
                        HEaHbZRnTX74EY6jGwYgJbfaqzs3oufQL2oPve4Dpump
                    </div>
                    <button onclick="copyContract()" class="bg-ocean-light hover:bg-ocean-dark text-white border-2 border-black rounded-xl p-2 ml-2 transition-colors">
                        <i data-lucide="copy" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

        </div>

        <div class="w-full h-8 z-20 mt-auto"></div>
    </section>

    <section id="memegenerator" class="py-20 px-4 responsive-bg about-bg border-t-4 border-black relative">
        <div class="max-w-6xl mx-auto relative z-10">
            <h2 class="font-heading text-5xl md:text-7xl text-center text-white text-stroke mb-8">MEME GENERATOR</h2>
            
            <div class="bg-white p-4 md:p-8 rounded-[3rem] border-4 border-black shadow-toon flex flex-col lg:flex-row gap-8">
                
                <div class="flex-1 flex justify-center items-center bg-[#FFF8E1] rounded-2xl border-4 border-black p-4 min-h-[400px] relative overflow-hidden">
                    <canvas id="memeCanvas" width="500" height="500" class="max-w-full h-auto cursor-crosshair shadow-lg"></canvas>
                    
                    <div id="meme-loader" class="absolute inset-0 flex flex-col items-center justify-center bg-white/80 rounded-2xl z-20 backdrop-blur-sm transition-opacity">
                        <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-ocean-dark mb-4"></div>
                        <span class="font-heading text-ocean-dark text-xl">Loading Template...</span>
                    </div>
                </div>

                <div class="w-full lg:w-96 flex flex-col gap-6">
                    
                    <div class="bg-[#FFF8E1] p-6 rounded-2xl border-4 border-black shadow-toon-hover">
                        <h3 class="font-heading text-2xl mb-4 text-ocean-dark">Add Text</h3>
                        
                        <textarea id="meme-text-input" placeholder="Enter text here..." class="w-full bg-white border-4 border-black rounded-xl p-3 font-body text-lg mb-4 resize-y min-h-[80px] focus:outline-none focus:border-ocean-light transition-colors"></textarea>
                        
                        <button onclick="addTextLayer()" class="w-full bg-ocean-light hover:bg-ocean-dark text-white font-heading text-xl py-2 rounded-xl border-4 border-black shadow-toon hover:translate-y-1 transition-all">
                            ADD LAYER
                        </button>
                    </div>

                    <div class="bg-[#FFF8E1] p-6 rounded-2xl border-4 border-black shadow-toon-hover">
                        <h3 class="font-heading text-2xl mb-4 text-ocean-dark">Settings</h3>

                        <div class="flex items-center justify-between gap-4 mb-4">
                            <span class="font-heading text-lg">Font:</span>
                            <div class="flex items-center gap-2 flex-grow justify-end">
                                <button onclick="changeFont(-1)" class="w-10 h-10 bg-white border-4 border-black rounded-lg flex items-center justify-center hover:bg-gray-100 font-bold hover:scale-105 transition-transform"><</button>
                                <span id="font-display" class="font-heading text-xl w-32 text-center truncate">Chewy</span>
                                <button onclick="changeFont(1)" class="w-10 h-10 bg-white border-4 border-black rounded-lg flex items-center justify-center hover:bg-gray-100 font-bold hover:scale-105 transition-transform">></button>
                            </div>
                        </div>

                        <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-xl border-4 border-black">
                            <input type="checkbox" id="stroke-toggle" class="w-6 h-6 accent-ocean-dark cursor-pointer" checked onchange="updateCurrentText()">
                            <span class="font-heading text-lg select-none">Black Outline</span>
                        </label>
                    </div>

                    <div class="mt-auto">
                        <button onclick="saveMeme()" class="w-full bg-[#FFD700] hover:bg-[#FFC107] text-black font-heading text-2xl py-4 rounded-xl border-4 border-black shadow-toon hover:translate-y-1 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="download" class="w-6 h-6"></i>
                            DOWNLOAD MEME
                        </button>
                        <p class="text-xs text-gray-500 text-center mt-3 font-body">Double click text to edit â€¢ Drag to move</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="responsive-bg shared-bg border-t-4 border-black">
        
        <section id="about" class="py-20 px-4">
            <div class="max-w-6xl mx-auto">
                <div class="bg-white/95 backdrop-blur-sm rounded-[3rem] border-4 border-orange-400 shadow-toon p-8 md:p-12 relative overflow-visible">
                    <div class="grid md:grid-cols-2 gap-12 items-center">
                        <div class="order-2 md:order-1">
                             <h2 class="font-heading text-5xl md:text-6xl text-orange-500 mb-6 text-stroke-sm transform -rotate-1">
                                WHAT IS $TRUMPBOB?
                            </h2>
                            <p class="font-body text-xl md:text-2xl text-gray-700 leading-relaxed mb-6">
                                BoB boB boB tRuMp BoB boB tRuMp,BoB boB boB tRuMp BoB boB tRuMp!
                            </p>
                            <p class="font-body text-xl text-gray-700 leading-relaxed">
                                p.s. i have no clue what's going on here
                            </p>
                        </div>
                        <div class="order-1 md:order-2 flex justify-center">
                            <div class="w-64 h-64 bg-ocean-light/20 rounded-full flex items-center justify-center relative overflow-hidden">
                                 <img src="images/character.png" class="w-48 h-48 object-contain transform rotate-12 animate-float">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-24 px-4 text-center relative overflow-hidden">
            <div class="max-w-4xl mx-auto relative z-10">
                <h2 class="font-heading text-6xl md:text-8xl text-white text-stroke mb-8 transform -rotate-2">
                    DON'T BE A BEACH.
                    <br/>
                </h2>
                <a href="https://pump.fun" target="_blank" class="inline-block bg-ocean-light hover:bg-ocean-dark text-white font-heading text-4xl px-12 py-4 rounded-full border-[6px] border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[4px] transition-all transform rotate-2">
                    TRUMP BOB ME!
                </a>
            </div>
        </section>
    </div>

    <footer class="bg-white border-t-4 border-black py-8 px-4">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="font-heading text-2xl text-gray-800">
                $TRUMPBOB Â© 2026
            </div>
            <div class="text-sm font-body text-gray-500 text-center md:text-right max-w-md">
            </div>
            <div class="flex gap-4">
                <a href="#" class="text-black hover:text-ocean-dark"><i data-lucide="twitter"></i></a>
                <a href="#" class="text-black hover:text-ocean-dark"><i data-lucide="send"></i></a>
            </div>
        </div>
    </footer>

    <script>
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        } else {
            console.warn("Lucide library not loaded properly or blocked.");
        }

        function toggleMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        function copyContract() {
            const address = "8s9f78s9d7f98s7d9f87sd9f87sd9f8meme8s7d9f8pump";
            const toast = document.getElementById('toast');
            
            navigator.clipboard.writeText(address).then(() => {
                showToast();
            }).catch(err => {
                const textArea = document.createElement("textarea");
                textArea.value = address;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
                showToast();
            });
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('translate-x-64', 'opacity-0');
            toast.classList.add('translate-x-0', 'opacity-100');
            
            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-64', 'opacity-0');
            }, 3000);
        }

        function sayHey() {
            const bubble = document.getElementById('speech-bubble');
            
            bubble.classList.remove('hidden');
            
            setTimeout(() => {
                bubble.classList.add('hidden');
            }, 2000);
        }

        let currentFontIndex = 0;
        let textObjects = [];
        let selectedTextIndex = -1;
        let isDragging = false;
        let isResizing = false;
        let dragTargetIndex = -1;
        let startX, startY;
        let initialFontSize = 40;

        const memeFonts = ['Chewy', 'Fredoka', 'Arial Black', 'Comic Sans MS'];

        const canvas = document.getElementById('memeCanvas');
        const ctx = canvas.getContext('2d');
        const textInputArea = document.getElementById('meme-text-input');
        const loader = document.getElementById('meme-loader');
        const img = new Image();

        img.onload = () => { 
            loader.classList.add('hidden'); 
            resizeCanvasToImage();
            drawCanvas(); 
        };

        img.onerror = () => { 
            if (img.src.includes('images/meme.png')) {
                console.warn('images/meme.png failed, trying meme.png in root...');
                img.src = 'meme.png';
            } else {
                loader.classList.add('hidden');
                console.warn(`Template failed to load completely.`);
                drawCanvas();
            }
        };

        window.addEventListener('load', () => {
             img.src = 'images/meme.png';
             initMemeGen();
        });

        function resizeCanvasToImage() {
            if (!img.complete || img.naturalWidth === 0) return;
            const maxWidth = 800;
            let w = img.naturalWidth;
            let h = img.naturalHeight;
            
            if (w > maxWidth) {
                const ratio = maxWidth / w;
                w = maxWidth;
                h = h * ratio;
            }

            canvas.width = w;
            canvas.height = h;
        }

        function changeFont(direction) {
            currentFontIndex += direction;
            if (currentFontIndex < 0) currentFontIndex = memeFonts.length - 1;
            if (currentFontIndex >= memeFonts.length) currentFontIndex = 0;
            
            const fontDisplay = document.getElementById('font-display');
            if(fontDisplay) fontDisplay.innerText = memeFonts[currentFontIndex];
            
            if(selectedTextIndex !== -1) {
                textObjects[selectedTextIndex].font = memeFonts[currentFontIndex];
                drawCanvas();
            }
        }

        function addTextLayer() {
            let text = textInputArea.value;
            if (!text) text = "New Text";

            const strokeToggle = document.getElementById('stroke-toggle');
            const useStroke = strokeToggle ? strokeToggle.checked : true;
            const scale = canvas.width / 500;

            const newText = {
                text: text,
                x: canvas.width / 2,
                y: 60 * scale,
                font: memeFonts[currentFontIndex],
                fontSize: 50 * scale,
                color: 'white',
                stroke: useStroke,
                strokeColor: 'black',
                lineWidth: 6 * scale,
                width: 0, 
                height: 0 
            };
            
            textObjects.push(newText);
            selectedTextIndex = textObjects.length - 1;
            drawCanvas();
            textInputArea.value = "";
            textInputArea.focus();
        }

        function updateCurrentText() {
            const strokeToggle = document.getElementById('stroke-toggle');
            const useStroke = strokeToggle ? strokeToggle.checked : true;
            
            if(selectedTextIndex !== -1) {
                textObjects[selectedTextIndex].stroke = useStroke;
                drawCanvas();
            }
        }

        function getTextMetrics(obj) {
            ctx.font = `bold ${obj.fontSize}px "${obj.font}"`;
            const lines = obj.text.split('\n');
            let maxWidth = 0;
            lines.forEach(line => {
                const width = ctx.measureText(line).width;
                if(width > maxWidth) maxWidth = width;
            });

            const lineHeight = obj.fontSize * 1.2;
            const totalHeight = lines.length * lineHeight;
            
            return { width: maxWidth, height: totalHeight };
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (img.complete && img.naturalHeight !== 0) {
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            } else {
                ctx.fillStyle = "#FFE082";
                ctx.fillRect(0,0, canvas.width, canvas.height);
                ctx.fillStyle = "#000";
                ctx.textAlign = "center";
                ctx.font = "30px Chewy";
                ctx.fillText("Template Not Found", canvas.width/2, canvas.height/2);
                ctx.font = "20px Fredoka";
                ctx.fillText("Please check images/meme.png", canvas.width/2, canvas.height/2 + 40);
            }

            textObjects.forEach((obj, index) => {
                ctx.font = `bold ${obj.fontSize}px "${obj.font}"`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const lines = obj.text.split('\n');
                const lineHeight = obj.fontSize * 1.2;
                const totalHeight = lines.length * lineHeight;
                
                const startY = obj.y - (totalHeight / 2) + (lineHeight / 2);

                lines.forEach((line, i) => {
                    const lineY = startY + (i * lineHeight);
                    
                    if (obj.stroke) {
                        ctx.strokeStyle = obj.strokeColor;
                        ctx.lineWidth = obj.lineWidth;
                        ctx.lineJoin = 'round';
                        ctx.strokeText(line, obj.x, lineY);
                    }
                    
                    ctx.fillStyle = obj.color;
                    ctx.fillText(line, obj.x, lineY);
                });

                const metrics = getTextMetrics(obj);
                obj.width = metrics.width;
                obj.height = metrics.height;

                if (index === selectedTextIndex) {
                    drawSelectionControls(obj);
                }
            });
        }

        function drawSelectionControls(obj) {
            const scale = canvas.width / 500;
            const padding = 10 * scale;
            const handleRadius = 8 * scale;
            const deleteRadius = 10 * scale;
            const lineWidth = 3 * scale;

            const w = obj.width + padding * 2;
            const h = obj.height + padding * 2;
            const x = obj.x - w / 2;
            const y = obj.y - h / 2;

            ctx.save();
            ctx.strokeStyle = '#4FC3F7'; 
            ctx.lineWidth = lineWidth;
            ctx.setLineDash([5 * scale, 5 * scale]);
            ctx.strokeRect(x, y, w, h);
            ctx.restore();

            ctx.beginPath();
            ctx.arc(x + w, y + h, handleRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#0288D1';
            ctx.lineWidth = lineWidth;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x + w, y, deleteRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#EF5350';
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = lineWidth;
            ctx.stroke();
            
            const xSize = 4 * scale;
            ctx.beginPath();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = lineWidth;
            ctx.moveTo(x + w - xSize, y - xSize);
            ctx.lineTo(x + w + xSize, y + xSize);
            ctx.moveTo(x + w + xSize, y - xSize);
            ctx.lineTo(x + w - xSize, y + xSize);
            ctx.stroke();
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }

        function handleMouseDown(e) {
            e.preventDefault();
            const pos = getMousePos(e);
            
            const scale = canvas.width / 500;
            const hitRadius = 20 * scale; 

            if (selectedTextIndex !== -1) {
                const obj = textObjects[selectedTextIndex];
                const padding = 10 * scale;
                const w = obj.width + padding * 2;
                const h = obj.height + padding * 2;
                const x = obj.x - w / 2;
                const y = obj.y - h / 2;

                const dxDelete = pos.x - (x + w);
                const dyDelete = pos.y - y;
                if (Math.sqrt(dxDelete*dxDelete + dyDelete*dyDelete) <= hitRadius) {
                    textObjects.splice(selectedTextIndex, 1);
                    selectedTextIndex = -1;
                    drawCanvas();
                    return;
                }

                const dxResize = pos.x - (x + w);
                const dyResize = pos.y - (y + h);
                if (Math.sqrt(dxResize*dxResize + dyResize*dyResize) <= hitRadius) {
                    isResizing = true;
                    dragTargetIndex = selectedTextIndex;
                    startX = pos.x;
                    startY = pos.y;
                    return;
                }
            }

            let hitFound = false;
            for (let i = textObjects.length - 1; i >= 0; i--) {
                const obj = textObjects[i];
                const halfW = obj.width / 2;
                const halfH = obj.height / 2;

                if (pos.x >= obj.x - halfW && pos.x <= obj.x + halfW &&
                    pos.y >= obj.y - halfH && pos.y <= obj.y + halfH) {
                    
                    selectedTextIndex = i;
                    isDragging = true;
                    dragTargetIndex = i;
                    startX = pos.x;
                    startY = pos.y;
                    hitFound = true;
                    
                    textInputArea.value = obj.text;
                    drawCanvas();
                    return;
                }
            }

            if (!hitFound) {
                selectedTextIndex = -1;
                drawCanvas();
            }
        }

        function handleDoubleClick(e) {
            e.preventDefault();
            const pos = getMousePos(e);
            
            for (let i = textObjects.length - 1; i >= 0; i--) {
                const obj = textObjects[i];
                const halfW = obj.width / 2;
                const halfH = obj.height / 2;

                if (pos.x >= obj.x - halfW && pos.x <= obj.x + halfW &&
                    pos.y >= obj.y - halfH && pos.y <= obj.y + halfH) {
                    
                    selectedTextIndex = i;
                    textInputArea.value = obj.text;
                    textInputArea.focus(); 
                    drawCanvas();
                    return;
                }
            }
        }

        function handleMouseMove(e) {
            const pos = getMousePos(e);
            const scale = canvas.width / 500;
            const hitRadius = 15 * scale;
            
            let cursor = 'default';
            if (isResizing) {
                cursor = 'nwse-resize';
            } else if (isDragging) {
                cursor = 'move';
            }
            canvas.style.cursor = cursor;

            if (isResizing && dragTargetIndex !== -1) {
                e.preventDefault();
                const obj = textObjects[dragTargetIndex];
                
                const dx = pos.x - obj.x;
                const dy = pos.y - obj.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                
                let newSize = dist / 2; 
                if (newSize < 10 * scale) newSize = 10 * scale; 
                
                obj.fontSize = newSize;
                drawCanvas();
                return;
            }

            if (isDragging && dragTargetIndex !== -1) {
                e.preventDefault();
                const obj = textObjects[dragTargetIndex];
                obj.x = pos.x;
                obj.y = pos.y;
                drawCanvas();
            }
        }

        function handleMouseUp(e) {
            e.preventDefault();
            isDragging = false;
            isResizing = false;
            dragTargetIndex = -1;
        }

        function saveMeme() {
            const tempSelection = selectedTextIndex;
            selectedTextIndex = -1;
            drawCanvas();
            
            try {
                const link = document.createElement('a');
                link.download = 'trumpbob-meme.png';
                link.href = canvas.toDataURL('image/png', 1.0); 
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                console.error("Save failed:", e);
                alert("If download doesn't start, long press/right click the image to save!");
            }

            selectedTextIndex = tempSelection;
            drawCanvas();
        }

        function initMemeGen() {
            if(!canvas) return;
            
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseout', handleMouseUp);
            canvas.addEventListener('dblclick', handleDoubleClick);

            canvas.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent("mousedown", { clientX: touch.clientX, clientY: touch.clientY });
                canvas.dispatchEvent(mouseEvent);
            }, false);
            canvas.addEventListener('touchmove', (e) => {
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent("mousemove", { clientX: touch.clientX, clientY: touch.clientY });
                canvas.dispatchEvent(mouseEvent);
                e.preventDefault(); 
            }, false);
            canvas.addEventListener('touchend', () => {
                const mouseEvent = new MouseEvent("mouseup", {});
                canvas.dispatchEvent(mouseEvent);
            }, false);

            if(textInputArea) {
                textInputArea.addEventListener('input', (e) => {
                    if (selectedTextIndex !== -1) {
                        textObjects[selectedTextIndex].text = e.target.value;
                        drawCanvas();
                    }
                });
            }
        }
    </script>
</body>
</html>


